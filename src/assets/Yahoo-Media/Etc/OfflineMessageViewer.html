<html>
    <head>
        <style TYPE="text/css">
 
        #ConversationBody{
        	position: relative; 
			top: 0; 
			left: 0; 
			width: 100%; 
			height:100%; 
			overflow-y: auto; 
			overflow-x: hidden; 
			z-index: 0; 
			word-wrap: break-word; 
			padding-bottom: .75em; 
			margin:0px;
			border:solid 2px #E0E0E0;
		}
                              
		.senderBlock {
			padding:.3em 0;
            position: relative;
            width: 100%;
			border-bottom: 1px solid #E0E0E0;
			cursor: default;
		
        }
		
		.senderBlock.selected {
			background-color:#F7F7F7;
		}
		
		

		.senderBlock.removed{
			display:none;
		}
		
		.senderBlock .contact {
            float: left;
        }
		
		.senderBlock .buttonBar {
			position:absolute;
			right:4px;
			top: 5px;
			visibility:hidden;
        }
		
		.senderBlock.selected .buttonBar {
			visibility:visible;
        }

		.contact img {
            vertical-align: middle;
        }
		
		.senderBlock .sendername {
            font-family: Tahoma;
            color: #585858;
            font-weight: bold;
			font-size:8pt;
            vertical-align: middle;
        }
		
		.senderBlock.replied .sendername{
			font-weight: lighter;
			font-size:9pt;
			color: #969696;
		}
		
		.senderBlock .userText {
			margin-left: 8px;
			color: black;
            font-family: Arial, Tahoma;
			font-size:9pt;
			float: left;
			font-weight:normal;
        }
		
		.senderBlock.replied .usertext{
			font-weight:lighter;
			color: #969696;
		}
		
		
		
		.senderBlock.selected .time{
			visibility:visible;
		}

		
		.displayImg {
            width: 32px;
            height: 32px;
			margin-left: 5px;
        }
		
		.presenceImg {
 			margin-top: 1px;
			margin-left: 2px;
        }
        
        .nonBuddyBlockTitle {
        	position: relative;
        	width:100%;
			height:2.65em;
            color: white;
			border-bottom: 1px solid #979797;
            font-family: Tahoma;
            font-size: 8pt;
            font-weight: bold;
			padding-left:8px;
			padding-top:6px;
			padding-bottom:6px;
			filter: "progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr='#C8C8C8',EndColorStr='#A1A1A0')";
        } 
		
		
		.senderBlock .dateBlock {
            clear: both;
            list-style: none;
            padding: 0 .1em;
            margin: 0;
        } 
		
		.senderBlock .dateBlock li {
            margin: 0;
            padding: 0;
            clear: both;
        } 
		
		.senderBlock li .date, .senderBlock li p {
            float: left;
        } 
		
		.senderBlock li .date {
			width: 60px;
			text-align: right;
			margin-top: .1em;
			font-family: Tahoma;
			font-size:8pt;
            color: #AA9CBC;
            vertical-align: top;
			visibility:visible;
        } 
		
		.senderBlock li .date.hidden {
            visibility: hidden;
        } 
             
		
		.senderBlock li .time {
            float: right;
            margin-left: 1em;
            visibility: hidden;
			font-family: Tahoma;
			font-size:8pt;
            color: #AA9CBC;
        } 
		
		.senderBlock.selected li .time {
            visibility: visible;
        }
		
		button {
            color: #898989;
			font: menu;
			padding: .2em .5em;
			background: #F0F0F0;
			border: 1px solid #C1C1C1;
            filter: "progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr=#FAFBFB,EndColorStr=#D8DADB)";
		}
		
		button.hover{
            filter: "progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr=#FFFFFF,EndColorStr=#E5E6E7)";
			border-top: 1px solid #cccccc;
			border-right: 1px solid #cccccc;
			border-left: 1px solid #cccccc;
			border-bottom: 1px solid #bfbfbf;
			background: #ffffff;
		}
		#allSpamButton.hover{
            filter: "progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr=#bfbfbf,EndColorStr=#a3a3a3)";
			color: #ffffff;
			background: #c1c1c1;
			border-top: 1px solid #a5a5a5;
			border-right: 1px solid #a5a5a5;
			border-bottom: 1px solid #959595;
			border-left: 1px solid #a5a5a5;
			font-weight: bold;

		}
				
        .spamButton, .replyButton {
        	font-weight: bold;
        }
	
        .spamButton {
        	margin-right: 3px;
			width: expression(Math.max(this.firstChild.offsetWidth, this.nextSibling.firstChild.offsetWidth) + 30);
        }
	
        .replyButton {
			width: expression(Math.max(this.firstChild.offsetWidth, this.previousSibling.firstChild.offsetWidth) + 30);
        }

		.allSpamButton {
			position:absolute;
			right: 3px;
			top: 3px;
			width:1px;
			overflow:visible;
            color: #fafafa;
			background: #b4b4b4;
			border-top: 1px solid #a5a5a5;
			border-right: 1px solid #a5a5a5;
			border-bottom: 1px solid #959595;
			border-left: 1px solid #a5a5a5;
			font-weight: bold;
            filter: "progid:DXImageTransform.Microsoft.Gradient(GradientType=0,StartColorStr='#B4B4B4',EndColorStr='#9A9A9A')";
        }
		
        #NonBuddyBlockId {
            margin-top: 0;
		
        } 
		
		#NonBuddyBlockId .removed {
            display:none;
        } 
		
		#NonBuddyBlockId .contact img {
            display: none;
		}
		#NonBuddyBlockId .contact .sendername {
            padding-left: 8px;
        } 
		
		#NonBuddyBlockId .contact {
            font-weight: bold;
        }  
		
		#BuddyBlockId {
            margin: 0;
        }
		
		#BuddyBlockId .buttonBar .spamButton {
			visibility: hidden;
        } 
		
		</style>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <title>OfflineMsgTest CSS</title>
        <script type="text/javascript">
        	//Define the yahoo object
        	if (!this.YAHOO) {YAHOO = {};}
			if (!this.YAHOO.Msgr) {
				YAHOO.Msgr = {};
			}


		    /* The following js function creates the following html
		     * Here it is an example:
	         *  <div id="BuddyBlockId">
	         *  <div id="Grace 1" class="senderBlock im hover" lateesttimestamp="7006" msgId="1132452398" isKnownSender="1">
	         *  	<div class="contact>
	         *  		<img id="displayImg-1132452398" class="displayImg" src="displayImg.png"/>
	         *  		<img id="presenceImg-1132452398" class="presenceImg" src="presenceImg.png"/>
	         *  		<div class="sendername">gyan 1</div>
	         *      </div>
	         *      <div class="buttonBar">
	         *  		<button>Spam</button>
	         *  		<button>Reply</button>
	         *      </div>
	         *  
	         *  <div id="11/23/08"> //date block
			 *  	<div id="1132452398" class="conversationItem 1132452398" senderId="Grace 1" lasttimestamp="13412593">
	         * 				<div class="date">11/23/08</div>
	         * 		  		<div class="time"> 11:32:21 </div>
	         * 				<p class="userText"> lalalalala </p>
	         * 	 	</div>
	         *  </div>
	         *  ...
	         *  </div>//end senderblock
	         *  </div>//end buddyblock
	         *  <div id="NonBuddyBlock">
	         *  ...
	         *  </div>
	         */
            YAHOO.Msgr.OfflineMsgMgr = (function(){
                var Const = {
                    COMMAND_REPLY_BUDDY: 1,
                    COMMAND_REPORT_SPAM: 2,
                    COMMAND_CLOSE_WINDOW: 3,
                    
                    //Global const declariation
                    LATEST_TIME_STAMP_ATTR: "latestTimeStamp",
                    MSG_TIME_STAMP_ATTR: "msgTimeStamp",
                    DATE_TIME_STAMP_ATTR: "dateTimeStamp",
                    ID_ATTR: "id",
                    NON_BUDDY_BLOCK_ID: "NonBuddyBlockId",
                    BUDDY_BLOCK_ID: "BuddyBlockId",
                    SHOW_DATE_CLASS: "date",
                    HIDE_DATE_CLASS: "date hidden",
                    SHOW_TIME_CLASS: "time",
                    HIDE_TIME_CLASS: "time hidden",
					SENDER_BLOCK_CLASS:"senderBlock",
					SENDER_MSGID_ATTR:"msgId",
					SENDER_KNOWN_ATTR:"isKnownSender",
					ALL_SPAM_BUTTON_CLASS : "allSpamButton",
					REPLY_BUTTON_CLASS : "replyButton",
					SPAM_BUTTON_CLASS : "spamButton",
                    
                    MSG_TYPE_IM: 0,
                    MSG_TYPE_SMS: 1,
				
					KEYCODE_UP_ARROW: 38,
					KEYCODE_DOWN_ARROW: 40,
					KEYCODE_LEFT_ARROW: 37,
					KEYCODE_RIGHT_ARROW: 39,
					KEYCODE_TAB: 9,
                    
                    //res keys
                    IDS_OFFLINE_REPLY_BTN_LABEL: "IDS_OFFLINE_REPLY_BTN_LABEL",
                    IDS_OFFLINE_ALL_SPIM_BTN_LABEL: "IDS_OFFLINE_ALL_SPIM_BTN_LABEL",
                    IDS_OFFLINE_SPIM_BTN_LABEL: "IDS_OFFLINE_SPIM_BTN_LABEL",
                    IDS_OFFLINE_CONTACT_NOT_IN_LIST: "IDS_OFFLINE_CONTACT_NOT_IN_LIST",
                    IDS_OFFLINE_WND_TITLE: "IDS_OFFLINE_WND_TITLE"
                }
				
                var Label = {
                    //set up the default values
                    replyBtnLabel: "Reply",
                    allSpimBtnLabel: "Report All as Spam",
                    spimBtnLabel: "Spam",
                    contactNotInListTitle: "Contacts not in your list",
                    wndTitle: "Offline Messages"
                }
                
                var spamList = new Array();
				var senderList = new Array();
				var allSpamButton = null;
				
                var selectedSenderBlock = {
					msgId:"",
					element:null,
					spamButton:null,
					replyButton:null
				};
				
                /**
                 * Initializer that load the style sheets. This is ran when the script is loaded.
                 */
                function init(){

					//set up keyboard maping
					document.onkeydown = function(){
						handleDocOnKeyDown(window.event);
					}
					document.onkeyup = function(){
						handleDocOnKeyUp(window.event);
					}
                }
  
              
                /**
                 *
                 * @param {String} inDisplayName - sender's display name
                 * @param {String} inMsg - the message text
                 * @param {bool} inIsKnownSender - true if sender is in the contact list
                 * @param {Number} inTimestamp - message's timestamp
                 * @param {String} inDisplayDate - message's localized date
                 * @param {String} inDisplayTime - message's  localized time
                 * @param {String} inDisplayImage - local path to the display image file
                 * @param {String} inPresenceImage - local path to the display presence image file
                 * @param {Object} inMsgId - message id to be use in Reply and Spam
                 */
                function addOfflineMsg(inDisplayName, inMsg, inIsKnownSender, inTimestamp, inDisplayDate, inDisplayTime, inDisplayImage, inPresenceImage, inMsgId){
                
                    if (typeof(inMessageType) == "undefined") {
                        inMessageType = Const.MSG_TYPE_IM;
                    }
                    
                    var event = {
                        displayName: inDisplayName,
                        message: inMsg,
                        isKnownSender: inIsKnownSender,
                        messageType: inMessageType,
                        timestamp: (+inTimestamp), //force type convert to Number
                        time: inDisplayTime,
                        date: inDisplayDate,
                        displayImage: inDisplayImage,
                        presenceImage: inPresenceImage,
                        msgId: inMsgId,
                        showDate: false
                    };
                    
                    var parent = null;
			
                    parent = getSenderBlock(event);
                    addEventToSenderBlock(parent, event);					
					sortList(event.isKnownSender);
					selectFirstMsg(false);
                };


				function sortList(isKnown){
					var targetList=null;
					if(isKnown){
						targetList = senderList;
					}else{
						targetList = spamList;
					}
					
					if (targetList.length > 0) {
							targetList.sort(function(a, b){
								var aTime = a.getAttribute(Const.LATEST_TIME_STAMP_ATTR);
								var bTime = b.getAttribute(Const.LATEST_TIME_STAMP_ATTR);
								return bTime - aTime;
							});				
					}
				}

				
                function selectFirstMsg(isTab){    
                    //special case, if the senderList is empty then
                    //the top most element to be selected is actually the AllSpamButton
                    if (senderList.length <= 0 && spamList.length > 0 && allSpamButton != null) { 
                    	if(selectedSenderBlock!=null){
                    	    resetSenderClassName(selectedSenderBlock.element, false);
                    	    selectedSenderBlock.element = null;
                    	    selectedSenderBlock.msgId = 0;
                    	}
                        setAllSpamButtonInFocus(true, isTab);
                    } else {
                        //if the new sender on the top is different from the element
                        //already selected then we toggle the selection
                        if (selectedSenderBlock.element == null ||
                        (selectedSenderBlock.element != null && senderList[0].id != selectedSenderBlock.element.id)) {
                            toggleSenderBlockSelection(senderList[0], null, true);
                        }
                    }
                    
                }
				
				function moveSelectionUp(isTab){
					if (selectedSenderBlock == null || selectedSenderBlock.element == null && !isAllSpamButtonInFocus()) {
						//nothing is selected;
						//select the first thing	
						selectFirstMsg(isTab);
					}
					else {
					
						//First check if all spam button is in focus first.
						//if it is then when we move up, we select the last element in the senderList
						if (senderList.length > 0 && isAllSpamButtonInFocus()) {
							toggleSenderBlockSelection(senderList[senderList.length - 1],null , true);
							setAllSpamButtonInFocus(false, isTab);
						}
						else {
							//Then we traverse the senderList, then take a stop at the "All Spam button"
							//then we traverse the spamList. 
							var selectedIndex = -1;
							if (senderList.length > 0) {
								selectedIndex = getSelectedIndex(senderList);
								if (selectedIndex > -1) {
									var pervious = selectedIndex - 1;
									//check if we are the top then we do nothing
									if (pervious > -1) {
										toggleSenderBlockSelection(senderList[pervious],null , true);
									}
									else {
									//we are at the top. do nothing
									}
								}
								else {
									selectPreviousItemInSpamList(isTab);
								}
							}
							else {
								selectPreviousItemInSpamList(isTab);
							}
						}
					}
				}
				
				function moveSelectionDown(isTab){
	
						//First check if all spam button is in focus first.
						//if it is then when we move down, we will first select the spam list
						    if (spamList.length > 0 && isAllSpamButtonInFocus()) {						
							toggleSenderBlockSelection(spamList[0],null , true);
							setAllSpamButtonInFocus(false,isTab);
						}
						else {
						    
							if (selectedSenderBlock == null || selectedSenderBlock.element == null) {
								//nothing is selected;
								//select the first thing	
								selectFirstMsg(isTab);
							}
							else {
								//Then we traverse the senderList, then take a stop at the "All Spam button"
								//then we traverse the spamList. 
								var selectedIndex = -1;
								if (senderList.length > 0) {
									selectedIndex = getSelectedIndex(senderList);
									if (selectedIndex > -1) {
										var next = selectedIndex + 1;
										//if we are at the end of the sender
										//we do nothing unless there is a spam
										//section then we set the focus on the 
										//all spam button.
										if (next >= senderList.length) {
											if (spamList.length > 0) {
												resetSenderClassName(senderList[senderList.length - 1], false);
												selectedSenderBlock.element = null;
												selectedSenderBlock.msgId = 0;
												setAllSpamButtonInFocus(true, isTab);
											}
											else {
											//no spam list, so we do nothing
											}
										}
										else {
											toggleSenderBlockSelection(senderList[next],null , true);
										}
									}
									else {
										selectNextItemInSpamList(isTab);
									}
								}
								else {
									selectNextItemInSpamList(isTab);
								}
							}
						}
				}
				
				//moving right can only move the spam button to reply button
				function moveSelectionRight(){
					setReplyToFocus();
				}
				
				function moveSelectionLeft(){
					setSpamToFocus();
				}
		
                function selectNextItemInSpamList(){
                    selectedIndex = getSelectedIndex(spamList);
					if (selectedIndex > -1) {
						var next = selectedIndex + 1;
						if (next < spamList.length) {
							toggleSenderBlockSelection(spamList[next],null , true);
						}
					}			
                }
				
                function selectPreviousItemInSpamList(isTab){
                    var selectedIndex = getSelectedIndex(spamList);
					if(selectedIndex == 0){		
                        //we are at the top we need to unset selection then set the spam button
                        resetSenderClassName(spamList[0], false);
                        setAllSpamButtonInFocus(true, isTab);
						
					}else if (selectedIndex > 0) {
                        var pervious = selectedIndex - 1;
                        if (pervious > -1) {
                            toggleSenderBlockSelection(spamList[pervious],null , true);
							if (isTab) {
								setTimeout(setReplyToFocus, 1);
							}
                        }
                    }
                }
				/**
				 * 
				 * @param {Array} targetList
				 * @return {int} index of the selected elem. -1 is returned if selected is not found
				 */
				function getSelectedIndex(targetList){
					var foundIndex = -1;
				
				    if(targetList!=null && selectedSenderBlock!=null && selectedSenderBlock.element!=null){
							foundIndex = findSenderBlockIndex(targetList,selectedSenderBlock.element);
					}
					
					return foundIndex;
				}
				
				function findSenderBlockIndex(targetList, senderBlock){
					var foundIndex = -1;
					if (targetList != null && senderBlock != null) {
						for (var i = 0; i < targetList.length && foundIndex < 0; i++) {
							var targetMsgId = targetList[i].getAttribute(Const.SENDER_MSGID_ATTR);
							var senderMsgId = senderBlock.getAttribute(Const.SENDER_MSGID_ATTR);
							if (targetMsgId != null && senderMsgId!=null) {
								if (senderMsgId == targetMsgId) {
									foundIndex = i;
								}
							}
						}
					}
					return foundIndex;				
				}
				
                function tabSelectionDown(){
				
                    //first check the focus on the all spam button.
                    //if it is there, then the next tap is going bring 
                    //us to the top of the spam list
                    if (spamList.length > 0 && isAllSpamButtonInFocus()) {
                        moveSelectionDown(true);	
                    }
                    else {
                        if (selectedSenderBlock == null || selectedSenderBlock.element == null) {
                            //nothing is selected;
                            //select the first thing	
                            selectFirstMsg(true);
                        }
                        else {
                            var endMsgId = -1;
                            if (spamList.length > 0) {
                                //check we are at the end,
                                endMsgId = spamList[spamList.length - 1].getAttribute(Const.SENDER_MSGID_ATTR);
                            }
                            else {
								if(senderList.length>0){
                                	endMsgId = senderList[senderList.length - 1].getAttribute(Const.SENDER_MSGID_ATTR);
								}
                            }
                            
							if (isButtonInFocus(selectedSenderBlock.replyButton)) {
								if (selectedSenderBlock.msgId != endMsgId) {
									moveSelectionDown(true);
								}else{
									//we are at the end.clear the selection and cycle back to the top
								
									selectFirstMsg(true);
								}
                            }
                        }
                    }
                }
				
                function tabSelectionUp(){
                    //first check the focus on the all spam button.
                    //if it is there, then the next tap is going bring 
                    //us to the top of the spam list
                   if (spamList.length > 0 && isAllSpamButtonInFocus()) {
                        moveSelectionUp(true);
                    }
                    else {
                        if (selectedSenderBlock == null || selectedSenderBlock.element == null) {
                            //nothing is selected;
                            //select the first thing	
                            selectFirstMsg(true);
                        }
                        else {
							//if the sender is a known sender then we don't need to be focused on 
							//the spam button before we move up.
                  			var isKnownSender = selectedSenderBlock.element.getAttribute(Const.SENDER_KNOWN_ATTR);
                            if (isButtonInFocus(selectedSenderBlock.spamButton) || isKnownSender=='1') {
								moveSelectionUp(true);
							}
                        }                        
                    }
                }
				
                /**
                 *
                 * @param {Object} inEvent
                 * @param {HTMLElement} the found parent sender block. If no parent is found a new one is created.
                 */
                function getSenderBlock(inEvent){
				
					var parent = document.getElementById(inEvent.displayName);
					if (parent !== null) {
						//if the latest message is newer than the previous one, then we
						//reset the parent's latest time stamp node.
						var parentTimeStamp = parent.getAttribute(Const.LATEST_TIME_STAMP_ATTR);
						if ((+parentTimeStamp) < inEvent.timestamp) {
							parent.setAttribute(Const.LATEST_TIME_STAMP_ATTR, inEvent.timestamp);
							insertBuddy(getBuddyBlock(inEvent.isKnownSender), parent, inEvent.timestamp);
						}
					}else {	
							parent = document.createElement("div");
							parent.className = Const.SENDER_BLOCK_CLASS;
							parent.setAttribute(Const.ID_ATTR, inEvent.displayName);
							parent.setAttribute(Const.LATEST_TIME_STAMP_ATTR, inEvent.timestamp);
							parent.setAttribute(Const.SENDER_MSGID_ATTR, inEvent.msgId);
							parent.setAttribute(Const.SENDER_KNOWN_ATTR, inEvent.isKnownSender?1:0);
							parent.ondblclick = function(){
								handleOnReply(inEvent.msgId,parent);
							}
							parent.onmouseenter = function(){
								//unselect the selected button that
								//was left over from keybard navigation
								unselectActiveButton();
								toggleSenderBlockSelection(parent, true, false);
								
							}       
							parent.onmouseleave = function(){
								toggleSenderBlockSelection(parent, false,false);
							}
							
							var dispImgHTML = '<img class="displayImg" id="displayImg-' + inEvent.msgId + '" src="' + inEvent.displayImage + '"/> ';
							var presenceImgHTML = '<img class="presenceImg" id="presenceImg-' + inEvent.msgId + '" src="' + inEvent.presenceImage + '"/> ';
							parent.innerHTML = ['<div class="contact">',
							dispImgHTML, 
							presenceImgHTML, 
							'<span class="sendername">', inEvent.displayName, '</span></div>'].join("");

							var buttonBar = document.createElement("div");
							buttonBar.className="buttonBar";
											
						
						 	var spamButton = createSpamButton(inEvent.msgId, Const.SPAM_BUTTON_CLASS, parent);
						 	buttonBar.appendChild(spamButton);
							var replyButton = createReplyButton(inEvent.msgId, Const.REPLY_BUTTON_CLASS, parent);
							buttonBar.appendChild(replyButton);
							parent.appendChild(buttonBar);
							
							//if the event is from a buddy then we just put in 
							//the buddy section
							var block = getBuddyBlock(inEvent.isKnownSender)
							insertBuddy(block, parent, inEvent.timestamp);
							
                            
                            if (inEvent.isKnownSender==false) {
								spamList.push(parent); //use when we mark all as spam
							}
							else {
								//add the sender to the list 
								//so we can manage its selection.
								senderList.push(parent);
							}
						
					}
					
					return parent;
				}
				
				/**
				* If the previous focus is on a button then we blur it.
				*/
				function unselectActiveButton(){
					if(typeof(window.document.activeElement)!="undefined"
					    && window.document.activeElement != null
					    && window.document.activeElement.type == "button"){
					    
						window.document.activeElement.blur();
					}
				}
				/**
				 * 
				 * @param {Element} senderBlock
				 * @param {String} messageClass
				 * @param {bool} doSelect        true if keep the selction attribute
				 */
                function resetSenderClassName(senderBlock, doSelect){
                    if(senderBlock!=null){
					    var hasRemoved = false;
					    var hasSelected = false;
					    var hasReplied = false;
					    if (typeof(senderBlock.className) != "undefined" && senderBlock.className != null) {
						    hasRemoved = senderBlock.className.indexOf("removed") > -1;
						    hasSelected = senderBlock.className.indexOf("selected") > -1;
						    hasReplied = senderBlock.className.indexOf("replied") > -1;
					    }
                        senderBlock.className =  Const.SENDER_BLOCK_CLASS;
                        if (hasRemoved) {
                            senderBlock.className += " removed";
                        }
                        else {
                            if (hasSelected && doSelect) {
                                senderBlock.className += " selected";
                            }
                            if (hasReplied) {
                                senderBlock.className += " replied";
                            }
                        }
                    }
                }
				
				/**
				 * 
				 * @param {HTMLElement} senderBlock
				 * @param {Bool} turnOn value true,false or null. If turn on is null then we just toggle.
				 * @param {Bool} autoSelection value, true,false or null. If value is false, then we don't do selection
				 */
                function toggleSenderBlockSelection(senderBlock, turnOn, autoSelection){   
					
					if (senderBlock != null) {
						var msgId = senderBlock.getAttribute(Const.SENDER_MSGID_ATTR);
						if (msgId != null) {	
							//turn off selection
							if (senderBlock.className.indexOf("selected") == -1 || turnOn==true) {
								//first set the previous selected block class to normal
								//if it hasnt been removed
								if (selectedSenderBlock.element != null &&
								selectedSenderBlock.element.className.indexOf("removed") == -1) {
									resetSenderClassName(selectedSenderBlock.element, false);
								}
								
								//then we set the current block as the sender
								senderBlock.className += " selected";
								selectedSenderBlock.msgId = msgId;
								selectedSenderBlock.element = senderBlock;
								fillButtons(senderBlock);
								
								if (autoSelection==true) {
									if (setSpamToFocus() == false) {
										setTimeout(setReplyToFocus, 1);
									}
									else {
										setTimeout(setSpamToFocus, 1);
									}
								}
							}
							else {
								//make sure the selected block hasnt been also removed
								//at the same time.
								if (senderBlock.className.indexOf("removed") == -1) {						
									resetSenderClassName(senderBlock, false);
									selectedSenderBlock.msgId = "";
									selectedSenderBlock.element = null;

								}
							}
						}
					}else{					
						
						//reset the selected block if NULL is passed in
						selectedSenderBlock.msgId = "";
						selectedSenderBlock.element = null;
					}		
                }
				
				function setSpamToFocus(){
					return setSpamFocus(true);	
				}
				function setReplyToFocus(){
					return setReplyFocus(true);
				}
				function setSpamToBlur(){
					return setSpamFocus(false);	
				}
				function setReplyToBlur(){
					return setReplyFocus(false);
				}
				
				function setSpamFocus(doFocus){
					
						var retval = false;
						if (selectedSenderBlock != null && selectedSenderBlock.spamButton != null) {
							try {
								if (doFocus) {
									setButtonFocus(selectedSenderBlock.spamButton);
								}else{
									selectedSenderBlock.spamButton.blur();
								}
								retval = true;
								
							} 
							catch (er) {
							}
							
						}
					return retval;
				}
				function setReplyFocus(doFocus){
					var retval = false;
					if(selectedSenderBlock!=null && selectedSenderBlock.replyButton!=null){
						try {
							if (doFocus) {
								setButtonFocus(selectedSenderBlock.replyButton);
							}else{
								selectedSenderBlock.replyButton.blur();
							}
							retval = true;
						}catch(er){}
					}
					return retval;
				}
				
				/**
				* @param {HTMLElement} inButton
				*/
				function setButtonFocus(inButton){
					var retval = false;
					if(inButton.style.visibility!="hidden" 
					&& inButton.style.display!="none" 
					&& inButton.disabled!=true){
						inButton.focus();
						retval = true;
					}
					return retval;
				}
				
				/**
				 * 
				 * @param {HTMLElement} senderBlock
				 */
				function fillButtons(senderBlock){
					var elems = senderBlock.getElementsByTagName("button");
					if (elems != null) {
						for (var i = 0; i < elems.length; ++i) {
							if (elems[i].className.indexOf(Const.REPLY_BUTTON_CLASS) > -1) {
								selectedSenderBlock.replyButton = elems[i];
							}
							else if (elems[i].className.indexOf(Const.SPAM_BUTTON_CLASS) > -1) {
									selectedSenderBlock.spamButton = elems[i];
							}
						}
					}
				}
						
				/***
				 * If the key pressed is enter key then we
				 * reply.
				 * @param {Event} event
				 * @param {String} inMsgId
				 */
                function handleDocOnKeyDown(e){
					
					var eventObj = (e)? e: (window.event);
                    if (eventObj!=null){
						switch(eventObj.keyCode){
							case Const.KEYCODE_UP_ARROW:
								 moveSelectionUp(false);
							break;
							case Const.KEYCODE_DOWN_ARROW:
   								 moveSelectionDown(false);
							break;
							case Const.KEYCODE_RIGHT_ARROW:
   								 moveSelectionRight();
							break;
							case Const.KEYCODE_LEFT_ARROW:
   								 moveSelectionLeft();
							break;
							case Const.KEYCODE_TAB:
							if (eventObj.shiftKey) {
								tabSelectionUp();
							}else {
								tabSelectionDown();
							}
							break;
						}  
                    }
					return true;
                }
				
                function handleDocOnKeyUp(e){
                
                    var eventObj = (e) ? e : (window.event);
                    if (eventObj != null) {
                        switch (eventObj.keyCode) {
                            case Const.KEYCODE_UP_ARROW:
                            case Const.KEYCODE_DOWN_ARROW:
							case Const.KEYCODE_RIGHT_ARROW:
							case Const.KEYCODE_LEFT_ARROW:
                            case Const.KEYCODE_TAB:
                                //do nothing
                                return false;
                                break;
                        }
                    }
                    return true;
                }
                

                /**
                 *
                 * @param {HTMLElement} inParent
                 * @param {HTMLElement} inBuddy
                 * @param {int} inNewTime
                 */
                function insertBuddy(inParent, inBuddy, inNewTime){
                    var children = inParent.getElementsByTagName("div");
                    var found = false;
                    for (i = 0; i < children.length && !found; ++i) {
                        var childAttr = children[i].getAttribute(Const.LATEST_TIME_STAMP_ATTR);
                        if (childAttr !== null && childAttr < inNewTime) {
							
                            inParent.insertBefore(inBuddy, children[i]);
                            found = true;
                        }
                    }
                    
                    if (!found) {
                        inParent.appendChild(inBuddy);
                    }

                }
                
                /**
                 * Find the date block under the parent. If one doesnt exists then we create one
                 * @param {HTMLElement} inParent
                 * @param {String} inDate
                 * @parem {Number} inTimeStamp we need the time stamp to compare the
                 * 				date so we know where to insert the date block.
                 * @param {HTMLElement} the date block node
                 */
                function getDateBlock(inParent, inDate, inEvent){
                    var dateBlock = null;
                    var siblingAfter = null;
                    var elems = inParent.getElementsByTagName("div");
                    //try to find the dateblock that matches the date id.
                    //at the same time we want to compare the time stamp
                    //We are not zero-ing out the timestamp, since by comparison by day
                    //we are in effect rounding out to a 24 hours period for the day.
					if (typeof(elems) != "undefined" && elems!=null) {
						for (var i = 0; i < elems.length; ++i) {
							if (elems[i].className == "dateBlock") {
							
								var elemTimeStamp = elems[i].getAttribute(Const.DATE_TIME_STAMP_ATTR);
								if ((+elemTimeStamp) > inEvent.timestamp) {
									siblingAfter = elems[i];
								}
								
								if (elems[i].id == inDate) {
									dateBlock = elems[i];
								}
							}
						}
					}
                    
                    if (dateBlock == null) {
                    	
                        dateBlock = document.createElement("div");
                        dateBlock.className = "dateBlock";
                        dateBlock.id = inDate;
                        dateBlock.setAttribute(Const.DATE_TIME_STAMP_ATTR, inEvent.timestamp);
                        if (siblingAfter != null) {
                            inParent.insertBefore(dateBlock, siblingAfter);
                        }
                        else {
                            inParent.appendChild(dateBlock);
                        }
                        
                        //since this is a new block we want to set the date initially
                        inEvent.showDate = true;
                    }
                    
                    return dateBlock;
                }
                
                
                //Since we get these block pretty frequently, I storing 
                //a ref of it here. They are initialize the first time
                //getBuddyBlock is called. 
                var nonBuddyBlock;
                var buddyBlock;
                /***
                 * @param {boolean} Can be either buddy or non buddy
                 * @return {HTMLElement} the BuddyBlock. Create one if one doesnt exists.
                 */
                function getBuddyBlock(isKnownSender){
                    //when there is no block, we always create
                    //the buddy block first so that shows
                    //up on the top
                    if (buddyBlock == null && nonBuddyBlock == null) {
                        initializeBuddyBlock();
                    }
                    
                    //only initialize a non-buddy block
                    //when we have at least 1 message
                    //that is a non-buddy other wise leave it
                    //empty
                    if (nonBuddyBlock == null && !isKnownSender) {
                        initializeNonBuddyBlock();
                    }
                    
                    if (isKnownSender) {
                        return buddyBlock;
                    }
                    else {
                        return nonBuddyBlock;
                    }
                    
                }
                
                function initializeBuddyBlock(){
                    buddyBlock = document.createElement("div");
                    buddyBlock.id = Const.BUDDY_BLOCK_ID;
                    document.body.appendChild(buddyBlock);
                }
                
                function initializeNonBuddyBlock(){
                    nonBuddyBlock = document.createElement("div");
                    nonBuddyBlock.id = Const.NON_BUDDY_BLOCK_ID;
                    allSpamButton = createAllSpamButton(Const.ALL_SPAM_BUTTON_CLASS);
                    
					nonBuddyBlockTitle = document.createElement("div");
					nonBuddyBlockTitle.className="nonBuddyBlockTitle";
					nonBuddyBlockTitle.innerText = Label.contactNotInListTitle;
                    nonBuddyBlockTitle.appendChild(allSpamButton); 
					
					nonBuddyBlock.appendChild(nonBuddyBlockTitle);    
					document.body.appendChild(nonBuddyBlock);             
                    
                }
                
                /**
                 * Create a reply button and hook up the click event to reply
                 * @param {String} msgId
                 * @param {String} class name
                 * @param {Element} the sender element so we can add handling to then click event
                 * @return {HTMLElement} the reply button with the associtead id
                 */
                function createReplyButton(inMsgId, inMsgButtonClass, inBlock){
                    //alert("create replyButton = " + Label.replyBtnLabel);
                    var button = createMsgButton(inMsgButtonClass, Label.replyBtnLabel);
                    button.onclick = function(){
                        handleOnReply(inMsgId, inBlock);
                    }
                    return button;
                }
				
				function handleOnReply(inMsgId, inBlock){
						Reply(inMsgId);
						if (typeof(inBlock.className) != "undefined"
						    && inBlock.className.indexOf("replied") == -1) {
							inBlock.className += " replied";
						}
				}
                
                /**
                 * Create a spam button
                 * @param {String} msgId
                 * @param {String} class name
                 * @param {Element} the sender element so we can add handling to then click event
                 * @return {Element} the spam button with the associtead id
                 */
                function createSpamButton(inMsgId, inMsgButtonClass, inBlock){
                    var button = createMsgButton(inMsgButtonClass, Label.spimBtnLabel);
                    button.onclick = function(){
                        ReportSpam(inMsgId);
                    }
                    return button;
                }
                
                /**
                 * Create a all spam button
                 * @param {String} inMsgId
                 * @param {String} inMsgButtonClass
                 * @return {HTMLElement} the all-spam button
                 */
                function createAllSpamButton(inMsgButtonClass){
                    var button = createMsgButton(inMsgButtonClass, Label.allSpimBtnLabel);
					button.id = inMsgButtonClass;
                    button.onclick = function(){
                        ReportAllAsSpam();
					
                    }
                    return button;
                }
                
                /**
                 * Utility method to create a general message button with
                 * AreaHover and DirectHover class appended for a consistent CSS style.
                 *
                 * @param {String} msgButtonClass
                 * @param {String} buttonName
                 * @return {HTMLElement} a message button
                 */
                function createMsgButton(msgButtonClass, buttonName){
                    var button = document.createElement("button");
                    button.className = msgButtonClass;
					button.onfocus =function(){
						button.className += " focus";					
					}
					button.onblur = function(){
						button.className = msgButtonClass;
					}
					button.onmouseenter = function(){
						button.className += " hover";		
					}
					button.onmouseleave = function(){
						button.className = msgButtonClass;

					}
                    button.innerHTML = "<span>" + buttonName + "</span>";
                    
                    return button;
                }
                
				/**
				 * @return {bool} false if the all spam button is not in focus or it is non existence.
				 */
				function isAllSpamButtonInFocus(){
					return  isButtonInFocus(allSpamButton);
				}
				
				function setAllSpamButtonInFocus(doFocus, needDelay){
					if (doFocus) {
						allSpamButton.className += " focus";
				
							if (needDelay) {
								setTimeout(allSpamButton.focus, 2);
							}
							else {
								try {
									allSpamButton.focus();
								}catch(er){}
							}
									
					}else{
						allSpamButton.className = "allSpamButton";
						if (needDelay) {
							setTimeout(allSpamButton.blur, 2);
						}else{
							try {
								allSpamButton.blur();
							}catch(er){}
						}
					}
					
				}
			
                
				function isButtonInFocus(button){
					var retval = false;
					if(button!=null){
						retval = button.className.indexOf("focus")>0;
					}
					return retval;
				}
				
                /**
                 * @param {HTMLElement} inParent
                 * @param {Object} inEvent
                 * @param {Number} message id added
                 */
                function addEventToSenderBlock(inParent, inEvent){
                
					var dateBlock = getDateBlock(inParent, inEvent.date, inEvent);
                    var messageClass = ["conversationItem", inEvent.msgId].join(" ");
                    var child = document.createElement("div");
                    child.setAttribute("class", messageClass);
                    child.setAttribute("id", inEvent.msgId);
					child.setAttribute("senderId", inEvent.displayName);
                    child.setAttribute(Const.MSG_TIME_STAMP_ATTR, inEvent.timestamp);
                    child.innerHTML = [
					'<li><div class="time">', inEvent.time, '</div>',
					'<div class="date',inEvent.showDate?"":"hidden",'"> ', inEvent.date, '</div>',
					'<p class="userText">', inEvent.message, '</p></li>'].join(" ");
                    
                    //insert the html the date block
					
                    insertMessage(dateBlock, child, inEvent.timestamp);
                    return inEvent.msgId;
                };
                
                /**
                 * Insert message in chronological order under the parent.
                 * Chronological is based on ascending timestamp. Also make sure to
                 * turn on the date if it is the first message in the date block.
                 * @param {HTMLElement} inParent
                 * @param {HTMLElement} inMessageNode - The complete message node
                 * @param {Number} inNewTime - The message node's timestapm
                 */
                function insertMessage(inParent, inMessageNode, inNewTime){
                
                    var children = inParent.getElementsByTagName("div");
                    var found = false;
                    for (i = 0; i < children.length && !found; ++i) {
                        //find the conversation block
                        var childAttr = children[i].getAttribute(Const.MSG_TIME_STAMP_ATTR);
                        if (childAttr !== null && (+childAttr) > inNewTime) {
                            //Need to insert a before a child. also check the date shown property.
                            //need to move the date show to current
                            var childDate = findDateNode(children[i]);
                            if (childDate != null && isDateShown(childDate)) {
                                var newMsgDate = findDateNode(inMessageNode);
                                if (newMsgDate != null) {
                                    hideDate(childDate);
                                    showDate(newMsgDate);
                                }
                            }
                            
                            inParent.insertBefore(inMessageNode, children[i]);
                            found = true;
                        }
                    }
                    
                    if (!found) {
                        inParent.appendChild(inMessageNode);
                    }
                }
                
                /**
                 * Given a message node return the first date node
                 * @param {Element} inMessageNode
                 * @return {Element} date node if found. Null if no date node is found.
                 */
                function findDateNode(inMessageNode){
                    var nodes = inMessageNode.getElementsByTagName("div");
                    for (j = 0; j < nodes.length; ++j) {
                        if (isDateClass(nodes[j])) {
                            return nodes[j];
                        }
                    }
                    
                    return null;
                }
                
                /**
                 *
                 * @param {HTMLElement} inNode
                 * @return {bool} true if date is shown
                 */
                function isDateShown(inNode){
                    return inNode.className != Const.HIDE_DATE_CLASS;
                }
                function isDateClass(inNode){
                    return inNode.className.indexOf("date") > -1;
                }
                
                /**
                 *
                 * @param {HTMLElement} inNode
                 */
                function hideDate(inNode){
                    inNode.className = Const.HIDE_DATE_CLASS;
                }
                
                /**
                 *
                 * @param {HTMLElement} inNode
                 */
                function showDate(inNode){
                    inNode.className = Const.SHOW_DATE_CLASS;
                }
                
                function urlClick(inElement){
                
                    window.external.openURL(inElement.href, false);
                    
                    // make sure that two windows don't open from clicking a link
                    event.cancelBubble = true;
                    event.returnValue = false;
                    
                    return false;
                }
                
                
                function urlUp(inElement){
                    //do nothing
                }
                
                /**
                 * Inovke external host to report msg reply
                 * @param {String} inMsgId
                 */
                function Reply(inMsgId){
                    if (window.external && typeof(window.external.InvokeCommand) != 'undefined') {
                        window.external.InvokeCommand(Const.COMMAND_REPLY_BUDDY, inMsgId);
                    }
                }
                
                /**
                 * Invoke the external host to report the message id as spam
                 * @param {String} inMsgId
                 */
                function ReportSpam(inMsgId){
                    
                    if (window.external && typeof(window.external.InvokeCommand) != 'undefined') {
                        window.external.InvokeCommand(Const.COMMAND_REPORT_SPAM, inMsgId);
                    }
                }

				/**
				 * Invoke the external host to report all spam message as spam.
				 * Internally it cycle through all spam messages and report each one 
				 * one by one.
				 */
               function ReportAllAsSpam(){
                    if (window.external && typeof(window.external.InvokeCommand) != 'undefined') {
                        //we need to get a copy of all the ids here since the spamList
                        //is being operated on asynchronously, its length is not fixed during the operation of this
                        //function.
                        var ids = getSpamIds(spamList); 
                        for (var i = 0; i < ids.length; ++i) {	
								window.external.InvokeCommand(Const.COMMAND_REPORT_SPAM, ids[i]);
                        }
                    }
                }
                
               /**
                 * Invoke the external host to close the window
                 */
                function CloseWindow(){
                    if (window.external && typeof(window.external.InvokeCommand) != 'undefined') {
                        window.external.InvokeCommand(Const.COMMAND_CLOSE_WINDOW, 0);
                    }
                }
                
                
                  /**
                * Get a copy of all the ids in the the spam list. 
                * @return an array of ids.
                */
                function getSpamIds(list){
                    var ids=[];
                    for (var i = 0; i < spamList.length; ++i) {
						var msgId = spamList[i].getAttribute(Const.SENDER_MSGID_ATTR);
						if (msgId != null) {
							ids.push(msgId);
						}
                    }
                    return ids;
                }
                
                
                /**
                 * This method is call by external to update the display image
                 * should it changes or that a new one is loaded especially
                 * for the times we are logging in the first time.
                 * 
                 * @param {String} inMsgId the message id
                 * @param {String} inDispImg the display image path
                 */
                function updateDispImage(inMsgId, inDispImg){
                    var imgElement = document.getElementById("displayImg-" + inMsgId);
                    if (imgElement != null) {
                        imgElement.src = inDispImg;
                    }
                }
                
				/**
				 * This method is call by external to update the presense image.
				 * Since the OPI is reflected real time, this method is called non-deterministically.
				 * @param {String} inMsgId
				 * @param {String} inPresenceImg
				 */
                function updatePresenceImage(inMsgId, inPresenceImg){
                    var imgElement = document.getElementById("presenceImg-" + inMsgId);
                    if (imgElement != null) {
                        imgElement.src = inPresenceImg;
                    }
                }
                
				/**
				 * This method is call by external to set all the string resources (label,buttons etc)
				 * for localization purpose. The format of the argument is in the following format:
				 * <div><
				 * @param {String} inRes 
				 */
                function setStringRes(inRes){
                    var xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                    xmlDoc.async = "false";
                    xmlDoc.loadXML(inRes);
                    
                    var all = xmlDoc.getElementsByTagName("*");
                    
                    //set up the default values
                    var replyBtnLabelNode = xmlDoc.getElementsByTagName(Const.IDS_OFFLINE_REPLY_BTN_LABEL)[0];
                    var allSpimBtnLabelNode = xmlDoc.getElementsByTagName(Const.IDS_OFFLINE_ALL_SPIM_BTN_LABEL)[0];
                    var spimBtnLabelNode = xmlDoc.getElementsByTagName(Const.IDS_OFFLINE_SPIM_BTN_LABEL)[0];
                    var contactNotInListTitleNode = xmlDoc.getElementsByTagName(Const.IDS_OFFLINE_CONTACT_NOT_IN_LIST)[0];
                    var wndTitleNode = xmlDoc.getElementsByTagName(Const.IDS_OFFLINE_WND_TITLE)[0];
                    
                    tempReplyBtnLabel = getValue(replyBtnLabelNode);
                    if (tempReplyBtnLabel != null) {
                        Label.replyBtnLabel = tempReplyBtnLabel
                        
                    }
                    
                    tempAllSpimBtnLabel = getValue(allSpimBtnLabelNode);
                    if (tempAllSpimBtnLabel != null) {
                        Label.allSpimBtnLabel = tempAllSpimBtnLabel
                    }
                    
                    tempSpimBtnLabel = getValue(spimBtnLabelNode);
                    if (tempSpimBtnLabel != null) {
                        Label.spimBtnLabel = tempSpimBtnLabel
                    }
                    
                    tempContactNotInListTitle = getValue(contactNotInListTitleNode);
                    if (tempContactNotInListTitle != null) {
                        Label.contactNotInListTitle = tempContactNotInListTitle
                    }
                    
                    tempWndTitle = getValue(wndTitleNode);
                    if (tempWndTitle != null) {
                        Label.wndTitle = tempWndTitle
                    }
                }
                
                function getValue(inNode){
                    if (inNode != null) {
                        return inNode.getAttribute("value");
                    }
                    return null;
                }
                
				/**
				 * This method is called fromo external to notify the script
				 * that the message has been sucessfully reported as spam.
				 * (as suppose to user bailing out by hitting "cancel" in the
				 * spam dialog box.
				 * @param {String} inMsgId
				 */
				function msgReportedForSpam(inMsgId){
					var elem = document.getElementById(inMsgId);
					if(elem!=null){
						var senderId = elem.getAttribute("senderId");
						if (senderId != null) {
							var sender = document.getElementById(senderId);
							if(sender!=null){
								if(sender.className.indexOf("removed")==-1){
									sender.className+=" removed";
									
									//also check the sender wasn't previously selected
									//otherwise we move down.
									if(selectedSenderBlock.element!=null
										&& selectedSenderBlock.element.id == senderId){
										moveSelectionDown(false);
									}
									
									//remove the elem from the spamList
									var idx = findSenderBlockIndex(spamList,sender);
									if(idx>-1){
										spamList.splice(idx,1);
									}
								}
							}
						}
					}
					
					
					if(spamList.length<=0){
						removeNonBuddyBlock();
						
						//if the senderList is also empty
						//then we close the window.
						if(senderList.length<=0){
						    CloseWindow();
						}
					}	
				}
				
				function removeNonBuddyBlock(){               
                    var block = document.getElementById(Const.NON_BUDDY_BLOCK_ID);
                    if (block != null) {
                        block.className += " removed";
                    }
                }
                
                return {
                    Init: init,
					AddOfflineMsg:addOfflineMsg,
					UpdateDispImage:updateDispImage,
					UpdatePresenceImage:updatePresenceImage,
					SetStringRes:setStringRes,
					MsgReportedForSpam:msgReportedForSpam,
					UrlClick:urlClick,
					UrlUp:urlUp
                }
                
            })();
            
			//-----------------------------------------------------------------------------------------------
			//Set Global methods accessiable to the app
			//-----------------------------------------------------------------------------------------------
            window.AddOfflineMsg = YAHOO.Msgr.OfflineMsgMgr.AddOfflineMsg;
			window.UpdateDispImage = YAHOO.Msgr.OfflineMsgMgr.UpdateDispImage;
			window.UpdatePresenceImage = YAHOO.Msgr.OfflineMsgMgr.UpdatePresenceImage;
			window.SetStringRes = YAHOO.Msgr.OfflineMsgMgr.SetStringRes;
			window.MsgReportedForSpam = YAHOO.Msgr.OfflineMsgMgr.MsgReportedForSpam;
			window.urlClick = YAHOO.Msgr.OfflineMsgMgr.UrlClick;
			window.urlUp = YAHOO.Msgr.OfflineMsgMgr.UrlUp;
			
			//------------------------------------------------------------------------------------------------
            //Entry point
            //------------------------------------------------------------------------------------------------ 
            YAHOO.Msgr.OfflineMsgMgr.Init();
            
            /*
            //------------------------------------------------------------------------------------------------
            //Standalone test method
            //------------------------------------------------------------------------------------------------
            var counter = 0;
            var testMsgs = ["This is funny !!! ha ha ha. How about some really long  message? Right. Is this long enough yet?", "Lol :D", "I love listening to <font color=#ff0000>this station</font> check it out. <a herf='http://yahoo.com'>here</a>", "Do I own you money?", "Wow"];
            var testTimes = [1000, 2000, 3000,4000];
            var testDates = ["11/27", "11/28", "11/29"];
		
            function testAddMessage(displayName, isKnownSender){       
				var msgId = 10000 + counter++;  
                var timestamp = testTimes[counter % 4] + counter;//randomize the timestamp a little.
                AddOfflineMsg(displayName, testMsgs[counter % 5], isKnownSender, timestamp, testDates[counter % 3], msgId, ".\\avartars\\1CLuy88l4AAEC-MFy6EJrGmXP7fVlww==.medium.png", ".\\opi\\online.png", msgId);
            };
			function testRemoveMessage(inMsgId){
				MsgReportedForSpam(inMsgId);
			}
            //------------------------------------------------------------------------------------------------

             var res = ['<div><Const.IDS_OFFLINE_REPLY_BTN_LABEL value="Reply"/>'
             ,'<IDS_OFFLINE_ALL_SPIM_BTN_LABEL value="Report All As Spam"/>',
             '<IDS_OFFLINE_SPIM_BTN_LABEL value="Spam"/>',
             '<IDS_OFFLINE_CONTACT_NOT_IN_LIST value="Contacts not in list"/></div>'
             ].join("");
             SetStringRes(res);
             */
            
            //debugger;
            //------------------------------------------------------------------------------------------------
        </script>
    </head>
    <body id=ConversationBody>
<!--form>
    <input type="button" value="G 1" onclick="testAddMessage('Grace1@somewhere.out.there.comLikereallylongnamereallyreally long',true)">
    <input type="button" value="G 2" onclick="testAddMessage('Grace 2',true)">
    <input type="button" value="G 3" onclick="testAddMessage('Grace 3',true)">
    <input type="button" value="N 1" onclick="testAddMessage('Spam 1@here.and.there.com',false)">
    <input type="button" value="N 2" onclick="testAddMessage('Spam 2',false)">
    <input type="button" value="N 3" onclick="testAddMessage('Spam 3',false)">
	<input type="button" value="del 1" onclick="testRemoveMessage(10000)">
	<input type="button" value="del 2" onclick="testRemoveMessage(10001)">
	<input type="button" value="del 3" onclick="testRemoveMessage(10002)">
</form-->
</html>
